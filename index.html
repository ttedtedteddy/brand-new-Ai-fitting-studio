<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Fitting Studio</title>
  
  <!-- 캐시 방지 및 최신 버전 강제 로드 -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <meta name="version" content="2.0.1-final">
  
  <!-- PWA 설정 -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#2563eb">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="AI Fitting Studio">
  <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiByeD0iMjQiIGZpbGw9IiMyNTYzZWIiLz4KPHN2ZyB4PSI0OCIgeT0iNDgiIHdpZHRoPSI5NiIgaGVpZ2h0PSI5NiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCI+CjxwYXRoIGQ9Im0xNSAxOC0zLTMtMy0zIi8+CjxwYXRoIGQ9Im0xNSA2LTMgMy0zIDMiLz4KPHN2ZyB4PSI0IiB5PSI0IiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJ3aGl0ZSIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiPgo8cGF0aCBkPSJNMTQgMmE4IDggMCAwIDEgMCAxNmwtNS01LTUtNWE4IDggMCAwIDEgMTAtNloiLz4KPGNpcmNsZSBjeD0iMTQiIGN5PSI4IiByPSIyIi8+Cjwvc3ZnPgo8L3N2Zz4KPC9zdmc+">
  
  <!-- 기존 스타일 -->
  <link rel="stylesheet" href="style.css?v=2.0.1">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
</head>
<body>
  <!-- 랜딩 페이지 -->
  <div id="landingPage" class="landing-page">
    <div class="landing-content">
      <h1 class="landing-title">AI Fitting Studio</h1>
      <p class="landing-subtitle">Complete your style with AI technology</p>
      <button id="tryMyStyleBtn" class="try-style-btn">Try my style</button>
    </div>
  </div>

  <!-- 모드 선택 페이지 -->
  <div id="modeSelectionPage" class="mode-selection-page" style="display: none;">
    <!-- 뒤로가기 버튼 -->
    <button id="backToLandingBtn" class="back-btn">
      ← Home
    </button>
    
    <div class="mode-selection-content">
      <h1 class="mode-title">AI Fitting Studio</h1>
      <p class="mode-subtitle">How would you like to start styling?</p>
      
      <div class="mode-options">
        <div class="mode-option">
          <button id="promptModeBtn" class="mode-btn">
            <div class="mode-text">
              <h3>Start with prompt</h3>
              <p>Complete your style using text prompts</p>
            </div>
          </button>
        </div>
        
        <div class="mode-option">
          <button id="clothesModeBtn" class="mode-btn">
            <div class="mode-text">
              <h3>Start with pictures of clothes</h3>
              <p>Complete your style using clothing images</p>
            </div>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- 옷 이미지 모드 페이지 -->
  <div id="clothesModeApp" style="display: none;">
    <!-- 뒤로가기 버튼 -->
    <button id="backToModeSelectionFromClothesBtn" class="back-btn">
      ← Mode Selection
    </button>
    
    <main>
      <div class="upload-container">
        <div class="upload-section">
          <h2>Upload Clothes</h2>
          <p style="color: var(--gray-600); margin-bottom: 1.5rem; font-size: 0.95rem;">
            Upload the clothes you want to try on
          </p>
          
          <div class="drag-drop-area" id="clothesDragDropArea">
            <div class="drag-drop-text">Drag and drop your image here</div>
            <div class="drag-drop-subtext">or click to select a file</div>
          </div>
          <input type="file" id="clothesImageUpload" accept="image/*" style="display: none;">
        </div>
        
        <div class="upload-section">
          <h2>Upload Full Body Photo</h2>
          <p style="color: var(--gray-600); margin-bottom: 1.5rem; font-size: 0.95rem;">
            Upload your full body photo for virtual fitting
          </p>
          
          <div class="drag-drop-area" id="bodyDragDropArea">
            <div class="drag-drop-text">Drag and drop your image here</div>
            <div class="drag-drop-subtext">or click to select a file</div>
          </div>
          <input type="file" id="bodyImageUpload" accept="image/*" style="display: none;">
        </div>
      </div>

      <div class="generate-container" style="margin-top: 2rem;">
        <h2>Virtual Fitting Generation</h2>
        <p style="color: var(--gray-600); margin-bottom: 1.5rem; font-size: 0.95rem;">
          AI will automatically fit the clothes on your full body photo
        </p>
        
        <!-- 의류 카테고리 선택 -->
        <div style="margin-bottom: 1.5rem;">
          <label for="clothingCategory" style="display: block; font-weight: 300; margin-bottom: 0.5rem; color: var(--gray-700);">
            Clothing Category
          </label>
          <select id="clothingCategory" style="width: 100%; padding: 0.75rem 1rem; border: 1px solid var(--gray-300); border-radius: 0; font-size: 1rem; transition: all 0.3s ease;" onchange="toggleDressLengthOption()">
            <option value="upper_body">Upper Body (Shirts, Blouses, Jackets)</option>
            <option value="lower_body">Lower Body (Pants, Skirts, Shorts)</option>
            <option value="dresses">Dresses (Dresses, One-pieces)</option>
            <option value="full_outfit">Full Outfit (Top + Bottom Combination)</option>
          </select>
          <p style="font-size: 0.85rem; color: var(--gray-500); margin-top: 0.5rem;">
            Select the type of clothing you uploaded. Choose "Full Outfit" to change both top and bottom simultaneously.
          </p>
        </div>
        
        <!-- 원피스 길이 선택 (원피스 선택 시에만 표시) -->
        <div id="dressLengthSection" style="margin-bottom: 1.5rem; display: none;">
          <label for="dressLength" style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: var(--gray-700);">
            📏 원피스 길이
          </label>
          <select id="dressLength" style="width: 100%; padding: 0.75rem 1rem; border: 2px solid var(--gray-300); border-radius: 0.75rem; font-size: 1rem; transition: all 0.3s ease;">
            <option value="short">🩳 짧은 길이 (미니 드레스, 무릎 위)</option>
            <option value="midi" selected>👗 중간 길이 (미디 드레스, 무릎 아래)</option>
            <option value="long">👘 긴 길이 (맥시 드레스, 발목까지)</option>
          </select>
          <p style="font-size: 0.85rem; color: var(--gray-500); margin-top: 0.5rem;">
            원하는 원피스 길이를 선택하세요. 더 정확한 결과를 위해 아래 설명란에 구체적인 길이를 적어주셔도 좋습니다.
          </p>
        </div>
        
        <!-- 추가 프롬프트 (선택사항) -->
        <div style="margin-bottom: 2rem;">
          <label for="clothesPrompt" style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: var(--gray-700);">
            💬 추가 설명 (선택사항)
          </label>
          <textarea 
            id="clothesPrompt" 
            placeholder="예: 파란색 긴팔 셔츠, 검은색 청바지, 화이트 원피스 등..." 
            style="width: 100%; padding: 0.75rem 1rem; border: 2px solid var(--gray-300); border-radius: 0.75rem; resize: vertical; min-height: 80px; font-size: 1rem; transition: all 0.3s ease;"
          ></textarea>
          <p style="font-size: 0.85rem; color: var(--gray-500); margin-top: 0.5rem;">
            옷의 색상, 스타일, 재질 등을 구체적으로 설명하면 더 정확한 결과를 얻을 수 있습니다.
          </p>
        </div>
        
        <button id="generateClothesBtn" disabled style="width: 100%; padding: 1.2rem 2rem; background: var(--gray-400); color: white; border: none; border-radius: 0.75rem; font-size: 1.1rem; font-weight: 700; cursor: not-allowed; transition: all 0.3s ease; position: relative; overflow: hidden;">
          🚀 가상 피팅 생성
        </button>
        <p style="text-align: center; color: var(--gray-500); margin-top: 1rem; font-size: 0.9rem;">
          전신사진과 옷 사진을 모두 업로드해주세요
        </p>
      </div>

      <!-- 결과 이미지 섹션 -->
      <div class="result-container">
        <h2>✨ 가상 피팅 결과</h2>
        <p style="color: var(--gray-600); margin-bottom: 1.5rem; font-size: 0.95rem;">
          AI가 생성한 가상 피팅 결과를 확인하세요
        </p>
        <div class="result-image-wrapper">
          <img id="clothesResultImage" src="" alt="가상 피팅 결과" style="display: none;">
          <div id="clothesResultPlaceholder" style="width: 100%; max-width: 512px; height: 300px; margin: 0 auto; border: 2px dashed var(--gray-300); border-radius: 1rem; display: flex; align-items: center; justify-content: center; color: var(--gray-400); font-size: 1rem;">
            가상 피팅 결과가 여기에 표시됩니다
          </div>
        </div>
        
        <div id="clothesActionButtons" class="action-buttons" style="display: none;">
          <button class="share-button instagram" onclick="shareClothesToInstagram()">
            📷 인스타그램 공유
          </button>
          <button class="share-button kakao" onclick="shareClothesToKakao()">
            💬 카카오톡 공유
          </button>
          <button class="save-button" onclick="saveClothesImage()">
            💾 이미지 저장
          </button>
        </div>
      </div>

      <!-- 구글 렌즈 섹션 -->
      <div class="google-search-container" id="clothesGoogleLensSection" style="display: none;">
        <h2>🔍 비슷한 제품 찾기 (구글 렌즈)</h2>
        <p style="color: var(--gray-600); margin-bottom: 1.5rem; font-size: 0.95rem;">
          결과 이미지를 구글 렌즈로 검색해 비슷한 제품을 찾아보세요
        </p>
        <button id="clothesGoogleLensBtn" class="google-search-btn">
          🔍 구글 렌즈로 이미지 검색
        </button>
      </div>
    </main>
  </div>

  <!-- 메인 애플리케이션 -->
  <div id="mainApp" style="display: none;">
    <!-- 뒤로가기 버튼 -->
    <button id="backToModeSelectionFromMainBtn" class="back-btn">
      ← Mode Selection
    </button>
    
    <header>
      <h1>AI Fitting Studio</h1>
      <p class="subtitle">
        Complete your style with AI technology
      </p>
    </header>

    <main>
      <div id="uploadMaskSection">
        <h2>Photo Upload & Masking</h2>
        <p style="color: var(--gray-600); margin-bottom: 1.5rem; font-size: 0.95rem;">
          Click or drag and drop to upload your photo.<br>
          After uploading, you can use the masking brush to select areas.
        </p>
        <div class="drag-drop-area" id="dragDropArea">
          <div class="drag-drop-text">Drag and drop your image here</div>
          <div class="drag-drop-subtext">or click to select a file</div>
        </div>
        <input type="file" id="imageUpload" accept="image/*" style="display: none;">
        <div id="maskSection" style="display:none; margin-top:2rem;">
          <h3>Masking Brush</h3>
          <p style="color: var(--gray-600); margin-bottom: 1.5rem; font-size: 0.95rem;">
            Use the brush to select areas you want to change (shown in orange)
          </p>
          <div id="brushToolbar">
            <label>Brush Size: 
              <input type="range" id="brushSize" min="5" max="80" value="30">
            </label>
            <button id="clearMaskBtn">Clear Mask</button>
          </div>
          <div id="canvasContainer">
            <canvas id="photoCanvas" width="512" height="768"></canvas>
            <canvas id="maskCanvas" width="512" height="768"></canvas>
          </div>
        </div>
      </div>

      <div style="max-width: 600px; margin: 2rem auto; background: var(--white); border-radius: 0; box-shadow: var(--shadow-lg); padding: 2.5rem 2rem; border: 1px solid var(--gray-200); position: relative; overflow: hidden;">
        <div style="content: ''; position: absolute; top: 0; left: 0; right: 0; height: 1px; background: var(--primary);"></div>
        <h2>AI Styling Generation</h2>
        <p style="color: var(--gray-600); margin-bottom: 1.5rem; font-size: 0.95rem;">
          Describe your desired style in text
        </p>
        
        <div style="display: flex; flex-wrap: wrap; justify-content: center; align-items: center; gap: 1rem;">
          <label style="flex: 1; min-width: 300px;">Prompt: 
            <input type="text" id="promptInput" placeholder="e.g., red dress, elegant, fashion" style="width: 100%; padding: 0.75rem; border: 1px solid var(--gray-300); border-radius: 0; margin-top: 0.5rem;"/>
          </label>
        </div>

        <!-- 생성 버튼 -->
        <div style="text-align: center; margin-top: 2rem;">
          <button id="generateBtn" style="background: var(--primary); color: var(--secondary); border: 1px solid var(--primary); padding: 1rem 2rem; border-radius: 0; font-weight: 300; font-size: 0.9rem; cursor: pointer; letter-spacing: 0.2em; text-transform: uppercase; transition: all 0.3s ease;">
            Generate AI Styling
          </button>
        </div>
      </div>

      <!-- 결과 섹션 -->
      <div id="resultSection" style="display: none; max-width: 600px; margin: 2rem auto; text-align: center;">
        <h2>Generated Result</h2>
        <div id="resultPlaceholder" style="display: none;"></div>
        <img id="resultImage" style="max-width: 100%; border-radius: 0; box-shadow: var(--shadow-lg);" />
        
        <!-- 액션 버튼 -->
        <div class="action-buttons">
          <button class="share-button instagram" onclick="shareToInstagram()">
            Share to Instagram
          </button>
          <button class="share-button kakao" onclick="shareToKakao()">
            Share to KakaoTalk
          </button>
          <button class="save-button" onclick="saveImage()">
            Save Image
          </button>
        </div>
      </div>

      <!-- 구글 렌즈 검색 섹션 -->
      <div class="google-search-container" id="googleLensSection" style="display: none;">
        <h2>Find Similar Products</h2>
        <p style="color: var(--gray-600); margin-bottom: 1.5rem; font-size: 0.95rem;">
          Search for similar products using Google Lens
        </p>
        <button id="googleLensBtn" class="google-search-btn">
          Search with Google Lens
        </button>
      </div>
    </main>

    <!-- 마스킹 브러쉬 작업 모달 -->
    <div id="maskModal" class="modal">
      <div class="modal-content">
        <h2 style="color: var(--cobalt-blue); margin-bottom: 1.5rem;">✨ 마스킹 브러시 작업</h2>
        <canvas id="modalPhotoCanvas" width="512" height="768"></canvas>
        <canvas id="modalMaskCanvas" width="512" height="768"></canvas>
        <div style="margin-top: 1.5rem; display: flex; gap: 1rem; justify-content: center;">
          <button id="applyMaskBtn">적용</button>
          <button id="closeMaskBtn">취소</button>
        </div>
      </div>
    </div>
  </div>

  <script src="app.js?v=2.0.1"></script>
</body>
</html> 